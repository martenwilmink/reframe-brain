(w=>{void 0===w&&(w={getCenter:L.Map.prototype.getCenter,setView:L.Map.prototype.setView,flyTo:L.Map.prototype.flyTo,setZoomAround:L.Map.prototype.setZoomAround,getBoundsZoom:L.Map.prototype.getBoundsZoom,PopupAdjustPan:L.Popup.prototype._adjustPan,RendererUpdate:L.Renderer.prototype._update}),L.Map.include({getBounds:function(){var t,e;return this._viewport?this.getViewportLatLngBounds():(e=this.getPixelBounds(),t=this.unproject(e.getBottomLeft()),e=this.unproject(e.getTopRight()),new L.LatLngBounds(t,e))},getViewport:function(){return this._viewport},getViewportBounds:function(){var t=this._viewport,e=L.point(t.offsetLeft,t.offsetTop),i=L.point(t.clientWidth,t.clientHeight);return 0!==i.x&&0!==i.y||(t=this.getContainer())&&(e=L.point(0,0),i=L.point(t.clientWidth,t.clientHeight)),L.bounds(e,e.add(i))},getViewportLatLngBounds:function(){var t=this.getViewportBounds();return L.latLngBounds(this.containerPointToLatLng(t.min),this.containerPointToLatLng(t.max))},getOffset:function(){var t=this.getSize().divideBy(2),e=this.getViewportBounds().getCenter();return t.subtract(e)},getCenter:function(t){var e,i=w.getCenter.call(this);return this.getViewport()&&!t&&(t=this.getZoom(),e=(e=this.project(i,t)).subtract(this.getOffset()),i=this.unproject(e,t)),i},setView:function(t,e,i){var o;return t=L.latLng(t),e=void 0===e?this._zoom:this._limitZoom(e),this.getViewport()&&(o=(o=this.project(t,this._limitZoom(e))).add(this.getOffset()),t=this.unproject(o,this._limitZoom(e))),w.setView.call(this,t,e,i)},flyTo:function(o,n,t){if(o=L.latLng(o),n=void 0===n?a:n,this.getViewport()&&(e=(e=this.project(o,this._limitZoom(n))).add(this.getOffset()),o=this.unproject(e,this._limitZoom(n))),!1===(t=t||{}).animate||!L.Browser.any3d)return this.setView(o,n,t);this._stop();var s=this.project(w.getCenter.call(this)),r=this.project(o),e=this.getSize(),a=this._zoom,h=Math.max(e.x,e.y),i=h*this.getZoomScale(a,n),l=r.distanceTo(s)||1,p=1.42,u=p*p;function d(t){t=(i*i-h*h+(t?-1:1)*u*u*l*l)/(2*(t?i:h)*u*l),t=Math.sqrt(t*t+1)-t;return t<1e-9?-18:Math.log(t)}function m(t){return(Math.exp(t)-Math.exp(-t))/2}function c(t){return(Math.exp(t)+Math.exp(-t))/2}var g=d(0);function _(t){return h*(c(g)*(m(t=g+p*t)/c(t))-m(g))/u}var f=Date.now(),v=(d(1)-g)/p,y=t.duration?1e3*t.duration:1e3*v*.8;return this._moveStart(!0,t.noMoveStart),function t(){var e=(Date.now()-f)/y,i=(1-Math.pow(1-e,1.5))*v;e<=1?(this._flyToFrame=L.Util.requestAnimFrame(t,this),this._move(this.unproject(s.add(r.subtract(s).multiplyBy(_(i)/l)),a),this.getScaleZoom(h/(e=i,h*(c(g)/c(g+p*e))),a),{flyTo:!0})):this._move(o,n)._moveEnd(!0)}.call(this),this},setZoomAround:function(t,e,i){var o,n;return this.getViewport()?(o=this.getZoomScale(e),n=this.getViewportBounds().getCenter(),o=(t instanceof L.Point?t:this.latLngToContainerPoint(t)).subtract(n).multiplyBy(1-1/o),n=this.containerPointToLatLng(n.add(o)),this.setView(n,e,{zoom:i})):w.setZoomAround.call(this,t,e,i)},getBoundsZoom:function(t,e,i){t=L.latLngBounds(t),i=L.point(i||[0,0]);var o=this.getZoom()||0,n=this.getMinZoom(),s=this.getMaxZoom(),r=t.getNorthWest(),t=t.getSouthEast(),a=this.getViewport(),a=(a?L.point(a.clientWidth,a.clientHeight):this.getSize()).subtract(i),i=this.project(t,o).subtract(this.project(r,o)),t=L.Browser.any3d?this.options.zoomSnap:1,r=a.x/i.x,a=a.y/i.y,i=e?Math.max(r,a):Math.min(r,a),o=this.getScaleZoom(i,o);return t&&(o=Math.round(o/(t/100))*(t/100),o=e?Math.ceil(o/t)*t:Math.floor(o/t)*t),Math.max(n,Math.min(s,o))},setActiveArea:function(t,e,i){var o;return e&&this._zoom&&(o=this.getCenter()),this._viewport||(e=this.getContainer(),this._viewport=L.DomUtil.create("div",""),e.insertBefore(this._viewport,e.firstChild)),"string"==typeof t?this._viewport.className=t:L.extend(this._viewport.style,t),o&&this.setView(o,this.getZoom(),{animate:!!i}),this}}),L.Renderer.include({_onZoom:function(){this._updateTransform(this._map.getCenter(!0),this._map.getZoom())},_update:function(){w.RendererUpdate.call(this),this._center=this._map.getCenter(!0)}}),L.GridLayer.include({_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var i in this._levels)i=Number(i),this._levels[i].el.children.length||i===t?(this._levels[i].el.style.zIndex=e-Math.abs(t-i),this._onUpdateLevel(i)):(L.DomUtil.remove(this._levels[i].el),this._removeTilesAtZoom(i),this._onRemoveLevel(i),delete this._levels[i]);var o=this._levels[t],n=this._map;return o||((o=this._levels[t]={}).el=L.DomUtil.create("div","leaflet-tile-container leaflet-zoom-animated",this._container),o.el.style.zIndex=e,o.origin=n.project(n.unproject(n.getPixelOrigin()),t).round(),o.zoom=t,this._setZoomTransform(o,n.getCenter(!0),n.getZoom()),L.Util.falseFn(o.el.offsetWidth),this._onCreateLevel(o)),this._level=o}},_resetView:function(t){t=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(!0),this._map.getZoom(),t,t)},_update:function(t){var e=this._map;if(e){var i=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter(!0)),void 0!==this._tileZoom){var o,e=this._getTiledPixelBounds(t),n=this._pxBoundsToTileRange(e),s=n.getCenter(),r=[],e=this.options.keepBuffer,a=new L.Bounds(n.getBottomLeft().subtract([e,-e]),n.getTopRight().add([e,-e]));if(!(isFinite(n.min.x)&&isFinite(n.min.y)&&isFinite(n.max.x)&&isFinite(n.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(o in this._tiles){var h=this._tiles[o].coords;h.z===this._tileZoom&&a.contains(new L.Point(h.x,h.y))||(this._tiles[o].current=!1)}if(1<Math.abs(i-this._tileZoom))this._setView(t,i);else{for(var l=n.min.y;l<=n.max.y;l++)for(var p=n.min.x;p<=n.max.x;p++){var u,d=new L.Point(p,l);d.z=this._tileZoom,this._isValidTile(d)&&((u=this._tiles[this._tileCoordsToKey(d)])?u.current=!0:r.push(d))}if(r.sort(function(t,e){return t.distanceTo(s)-e.distanceTo(s)}),0!==r.length){this._loading||(this._loading=!0,this.fire("loading"));for(var m=document.createDocumentFragment(),p=0;p<r.length;p++)this._addTile(r[p],m);this._level.el.appendChild(m)}}}}}}),L.Popup.include({_adjustPan:function(){var t,e,i,o,n,s,r,a;this._map._viewport?this.options.autoPan&&(this._map._panAnim&&this._map._panAnim.stop(),s=(t=this._map)._viewport,e=this._container.offsetHeight,a=this._containerWidth,i=L.point(s.offsetLeft,s.offsetTop),(i=new L.Point(this._containerLeft-i.x,-e-this._containerBottom-i.y))._add(L.DomUtil.getPosition(this._container)),i=t.layerPointToContainerPoint(i),n=L.point(this.options.autoPanPadding),o=L.point(this.options.autoPanPaddingTopLeft||n),n=L.point(this.options.autoPanPaddingBottomRight||n),s=L.point(s.clientWidth,s.clientHeight),r=0,i.x+a+n.x>s.x&&(r=i.x+a-s.x+n.x),i.x-r-o.x<(a=0)&&(r=i.x-o.x),i.y+e+n.y>s.y&&(a=i.y+e-s.y+n.y),i.y-a-o.y<0&&(a=i.y-o.y),r||a)&&t.fire("autopanstart").panBy([r,a]):w.PopupAdjustPan.call(this)}})})(window.leafletActiveAreaPreviousMethods);